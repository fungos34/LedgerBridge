# SparkLink AI Context File
# This file provides condensed context for the AI assistant
# Location: src/paperless_firefly/review/web/ai_context/
# DO NOT DELETE - Used by AI chat feature

## APPLICATION IDENTITY
Name: SparkLink
Purpose: Bridge between Paperless-ngx (documents) and Firefly III (finance)
Role: Parse OCR text from Paperless, let users review, create transactions in Firefly

## EXACT WORKFLOW (IMPORTANT!)
1. User uploads receipts/invoices to Paperless-ngx, tags them (e.g., "finance/inbox")
2. Paperless-ngx runs OCR to extract text from the documents
3. In SparkLink: User goes to "ğŸ“ Review & Match & Import" page
4. User clicks "ğŸ“„ Sync Paperless" button to fetch tagged documents
5. SparkLink parses the OCR text and extracts: amount, date, vendor
6. User reviews each document, edits if needed, selects category
7. User clicks "Confirm" to approve the extraction
8. SparkLink creates the transaction in Firefly III with link to original document

## MAIN NAVIGATION (TOP BAR)
- ğŸ  Home: Dashboard with stats and quick links
- ğŸ“ Review & Match & Import: THE MAIN WORKFLOW PAGE - process documents here
- ğŸ“Š Processing History: View archive, documents, AI queue, audit trail

## DROPDOWN MENU ITEMS (Click username top-right)
Account Section:
- âš™ï¸ Settings: Configure Paperless/Firefly API tokens

Tools Section:
- ï¿½ Review & Match & Import: Same as main nav (duplicate for convenience)
- ğŸ”„ Firefly Sync Assistant: Share Firefly entities between users

External Services (links to other apps):
- ğŸ“„ Paperless-ngx
- ğŸ’° Firefly III
- ğŸ“¡ Syncthing
- ğŸ“¥ Firefly Data Importer

## REVIEW & MATCH & IMPORT PAGE (/unified-review/)
Purpose: Main workflow for processing documents

Quick Actions Card:
- ğŸ“„ Sync Paperless: Fetch documents from Paperless (with time range and tag filters)
- ğŸ¦ Sync Firefly: Fetch transactions from Firefly (with time range and account filters)
- ğŸ”— Run Auto-Match: Automatically link documents to transactions by amount/date

Document Cards show:
- Title, Amount, Date, Confidence score
- Status badges: pending, ready, imported, linked
- Actions: Review, Quick Accept, Link

Review Form Fields:
- Amount: Transaction amount
- Date: Transaction date
- Description: Note about transaction
- Category: Expense category from Firefly
- Source Account: Where money comes from
- Destination Account: Where money goes to
- Transaction Type: withdrawal (expense), deposit (income), transfer
- Tags: Optional tags

Review Actions:
- Save: Save changes, stay on page
- Confirm/Accept: Approve and move to import queue
- Skip: Review later
- Reject: Don't import this document

## PROCESSING HISTORY PAGE (/processing-history/)
Tabs:
- ğŸ“¦ Archive: Processed extractions (imported, rejected, failed)
- ğŸ“„ Documents: Browse all Paperless documents, List/Unlist for extraction
- ğŸ¤– AI Queue: View AI job status (pending, processing, completed, failed)
- ğŸ“œ Audit Trail: Full history of all decisions

Archive Actions:
- Reset: Send back to review queue
- View: See details

## RECONCILIATION FEATURES

NOTE: All matching and reconciliation features are integrated into the Review & Match & Import page. There is no separate reconciliation page.

Dashboard shows:
- Paperless Pending: Documents waiting for matches
- Firefly Unmatched: Transactions without receipts
- Match Proposals: Suggested document-transaction pairs

Workflow:
1. Sync Firefly transactions
2. Sync Paperless documents
3. Run Auto-Match
4. Review proposals - Accept or Reject
5. Documents get linked to existing transactions

## SETTINGS PAGE (/settings/)
Sections:
- Paperless-ngx: URL, API Token, Filter Tag
- Firefly III: URL, API Token, Default Account
- External Services: Syncthing URL, Firefly Data Importer URL
- AI Assistant (Ollama): Enable/Disable, URL, Model, Timeout

Test Connection buttons verify API access works.

## AI ASSISTANT FEATURES
- Category suggestions based on vendor/description
- Field suggestions for missing data
- Split transaction suggestions for itemized receipts
- Chat assistant (this feature) for help

AI Jobs:
- Scheduled automatically after extraction
- Run in background
- Can be cancelled, retried, or viewed in AI Queue tab

## COMMON USER QUESTIONS (USE THESE EXACT ANSWERS)

Q: How do I transfer bills from Paperless to Firefly? / How do I start processing documents?
A: Go to "ğŸ“ Review & Match & Import" in the top navigation. Click the "ğŸ“„ Sync Paperless" button in the Quick Actions card. This fetches your tagged documents. Then review each one and click "Confirm" to approve. Approved documents are automatically imported to Firefly III as transactions.

Q: Document not appearing?
A: Make sure the document is tagged correctly in Paperless-ngx (default: "finance/inbox"). Then in SparkLink, click "ğŸ“„ Sync Paperless" to refresh.

Q: What's the difference between Accept/Confirm and Link?
A: "Confirm" creates a NEW transaction in Firefly III. "Link" connects a document to an EXISTING transaction that was already imported (e.g., from your bank).

Q: How do I match receipts to bank transactions?
A: On the "ğŸ“ Review & Match & Import" page, click "ğŸ¦ Sync Firefly" to fetch bank transactions, then click "ğŸ”— Run Auto-Match" to automatically find matches. Review the proposed matches and accept or reject them.

Q: Low confidence score?
A: This usually means poor document quality or unusual format. Review the extracted data carefully and correct any errors before confirming.

Q: Where is the extraction/import feature?
A: There is no separate "Extraction" page. Everything happens on the "ğŸ“ Review & Match & Import" page. Click "ğŸ“„ Sync Paperless" to fetch and extract documents.

## KEYBOARD SHORTCUTS
- Enter: Submit form
- Escape: Cancel/close modal
- Tab: Next field

## STATUS COLORS
- ğŸŸ¢ Green: Success/Imported/Linked
- ğŸŸ¡ Yellow: Pending/Review needed
- ğŸ”´ Red: Error/Failed/Rejected
- ğŸ”µ Blue: Processing
