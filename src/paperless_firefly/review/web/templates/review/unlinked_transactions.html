{% extends "review/base.html" %}

{% block title %}Unlinked Transactions{% endblock %}

{% block extra_css %}
<style>
    .tx-row {
        transition: background-color 0.15s ease;
    }
    
    .tx-row:hover {
        background-color: var(--gray-50);
    }
    
    .amount-cell {
        font-family: "SFMono-Regular", Consolas, monospace;
        font-weight: 600;
    }
    
    .description-cell {
        max-width: 300px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    .category-badge {
        font-size: 0.625rem;
        padding: 0.125rem 0.375rem;
        background: var(--gray-100);
        border-radius: 0.25rem;
        color: var(--gray-700);
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>üîç Unlinked Transactions ({{ total_count }})</h2>
        <a href="{% url 'reconciliation_list' %}" class="btn btn-outline">
            ‚Üê Back to Reconciliation
        </a>
    </div>
    
    {% if transactions %}
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Date</th>
                <th>Amount</th>
                <th>Description</th>
                <th>Destination</th>
                <th>Category</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for tx in transactions %}
            <tr class="tx-row">
                <td class="text-mono text-sm">#{{ tx.firefly_id }}</td>
                <td>{{ tx.date }}</td>
                <td class="amount-cell">{{ tx.amount }}</td>
                <td class="description-cell" title="{{ tx.description }}">
                    {{ tx.description|truncatechars:40 }}
                </td>
                <td class="text-sm">{{ tx.destination_account|default:"-" }}</td>
                <td>
                    {% if tx.category %}
                    <span class="category-badge">{{ tx.category }}</span>
                    {% else %}
                    <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{{ firefly_url }}/transactions/show/{{ tx.firefly_id }}" 
                       target="_blank" class="btn btn-sm btn-outline" title="View in Firefly">
                        ‚Üó
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <h3>‚úÖ All transactions linked</h3>
        <p>No unlinked transactions found in the cache.</p>
        <p class="mt-4 text-muted text-sm">
            Run reconciliation to refresh the transaction cache.
        </p>
    </div>
    {% endif %}
</div>

<div class="card mt-4">
    <div class="card-header">
        <h3>üí° Tips</h3>
    </div>
    <div class="card-body">
        <ul style="margin: 0; padding-left: 1.5rem; color: var(--gray-600);">
            <li>Unlinked transactions are Firefly transactions without associated document receipts.</li>
            <li>Use the manual link form in the Reconciliation view to link documents to transactions.</li>
            <li>Run the matching engine to automatically find potential matches.</li>
        </ul>
    </div>
</div>
{% endblock %}